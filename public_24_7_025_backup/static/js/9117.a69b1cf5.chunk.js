"use strict";(self.webpackChunkgeneral_dms=self.webpackChunkgeneral_dms||[]).push([[9117],{19117:(e,t,s)=>{s.r(t),s.d(t,{default:()=>te});var n=s(65043),r=s(75304),a=s(38477),i=s(25852),o=s(13718),l=s(8586),c=s(87382),d=s(44864),m=s(94576),h=s(32936),u=s(83565),x=s(58441),g=s(56253),p=s(96957),f=s(68499),j=s(97508),w=s(53536),A=s.n(w),v=s(67735),b=s(70579);const y=(0,j.Ng)((e=>({users:e.allFields.users})))((e=>{const t=e.workflowMaster||{},s=A().orderBy(t.workflow_users,["level"],"asc")||[];return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(i.A,{className:"my-2",children:[(0,b.jsx)(o.A,{xs:5,sm:4,md:3,children:(0,b.jsx)(r.A,{className:"shadow",children:(0,b.jsx)(a.A,{children:(0,b.jsx)("span",{children:t.requestId})})})}),(0,b.jsx)(o.A,{xs:7,sm:8,md:9}),(0,b.jsx)(o.A,{sm:4,md:3,children:(0,b.jsx)(r.A,{className:t.assignedTo===t.initiatorId?"shadow bg-warning blink_me":"bg-info shadow",children:(0,b.jsx)(d.A,{style:{height:60,alignItems:"center"},children:(0,b.jsx)("strong",{children:(0,v.w)(t.initiatorId,e.users)})})})},t.initiatorId),s.map((s=>{const n=t.assignedTo===s.userId;return(0,b.jsx)(o.A,{sm:4,md:3,children:(0,b.jsx)(r.A,{className:n?"shadow bg-warning blink_me":"shadow bg-info",children:(0,b.jsx)(d.A,{style:{height:60,alignItems:"center"},children:(0,b.jsx)("strong",{children:(0,v.w)(s.userId,e.users)})})})},s.userId)}))]})})}));var N=s(45413),k=s(64412),I=s(54410),S=s(77275),E=s(39956),C=s.n(E),$=(s(90425),s(28096)),D=s(18039);const T=(0,j.Ng)((e=>({users:e.allFields.users})))((e=>{const t=e.workflowMaster||{},s=t.workflow_users||[],m=Number(localStorage.getItem(D.uW)),h=A().find(s,{userId:m})||{},[u,x]=(0,n.useState)(""),[g,p]=(0,n.useState)(I.EditorState.createEmpty()),[j,w]=(0,n.useState)(""),y=s=>{const n=s.target.name;if("return"===n){if(!u)return void $.oR.warn("An user must be selected");if(!j)return void $.oR.warn("Comment must not be empty")}"comment"!==n||j?(0,f.Dn)({action:n,data:{comment:j,workflowMasterId:t.id,userId:u}},((t,s)=>{t?$.oR.error("Error!"):($.oR.success("Success!"),e.getData())})):$.oR.warn("Comment must not be empty")};return"Approved"===t.currentStatus||t.assignedTo!==m?null:(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(r.A,{className:"my-2 shadow",children:[(0,b.jsx)(a.A,{children:"Comment"}),(0,b.jsx)(d.A,{children:(0,b.jsxs)(i.A,{children:[(0,b.jsx)(o.A,{md:12,children:(0,b.jsx)(N.A,{children:(0,b.jsx)(S.Editor,{editorState:g,wrapperClassName:"border border-dark",placeholder:"Enter comment (optional)",onEditorStateChange:e=>{p(e);const t=C()((0,I.convertToRaw)(e.getCurrentContent()));w(t)},toolbar:{options:["inline","blockType","fontSize","fontFamily","list","textAlign","colorPicker","link","history"]}})})}),(0,b.jsx)(o.A,{md:5,className:"mt-3",children:m!==t.assignedTo?null:(0,b.jsxs)(b.Fragment,{children:[h.userId?(0,b.jsxs)(N.A,{children:[(0,b.jsx)(l.A,{for:"returnTo",children:(0,b.jsx)("strong",{children:"Return to"})}),(0,b.jsxs)(k.A,{className:"rounded",id:"returnTo",type:"select",value:u,onChange:e=>{let{target:{value:t}}=e;return x(t)},children:[(0,b.jsx)("option",{value:"",children:"__ NONE __"}),(0,b.jsx)("option",{value:t.initiatorId,children:(0,v.w)(t.initiatorId,e.users)}),s.map((t=>t.level<h.level?(0,b.jsx)("option",{value:t.userId,children:(0,v.w)(t.userId,e.users)},t.id):null))]})]}):null,h.userId?(0,b.jsx)(c.A,{className:"text-white mx-1",name:"return",onClick:y,color:"warning",size:"sm",children:"Return"}):null,u||"approver"!==h.type?null:(0,b.jsx)(c.A,{className:"text-white mx-1",name:"complete",onClick:y,color:"success",size:"sm",children:"Approve"}),u||"approver"===h.type?null:(0,b.jsx)(c.A,{className:"text-white mx-1",name:"submit",onClick:y,color:"success",size:"sm",children:"Submit"})]})})]})})]})})}));var _=s(86178),M=s.n(_);const O=(0,j.Ng)((e=>({users:e.allFields.users})))((e=>{const[t,s]=(0,n.useState)([]),r=e=>{switch(e){case"Initiate":return{color:"bg-default",icon:"fas fa-hourglass-start bg-default"};case"Comment":return{color:"bg-secondary",icon:"fas fa-comment-dots bg-secondary"};case"Return":return{color:"bg-warning",icon:"fas fa-fast-backward bg-warning"};case"Submit":return{color:"bg-info",icon:"fas fa-dot-circle-o bg-info"};case"Approved":return{color:"bg-success",icon:"fas fa-check bg-success"};default:return{color:"",icon:""}}};return(0,n.useEffect)((()=>{const t=e.workflowLogs||[],n=[];t.forEach((e=>{const t=M()(e.createdAt).format("YYYY-MM-DD"),s=A().findIndex(n,{date:t});return s>=0?(n[s]={date:n[s].date,logs:[...n[s].logs,e]},e.date=t):n.push({date:t,logs:[e]}),e})),s(n)}),[e.workflowLogs]),(0,b.jsx)("section",{className:"mt-3",children:(0,b.jsx)("div",{className:"container-fluid",children:t.map(((t,s)=>(0,b.jsxs)("div",{className:"timeline mb-0 mt-0 pb-4",children:[t.date?(0,b.jsx)("div",{className:"time-label",children:(0,b.jsx)("span",{className:r(t.action).color,children:t.date})}):null,t.logs.map((t=>(0,b.jsxs)("div",{children:[(0,b.jsx)("i",{className:r(t.action).icon}),(0,b.jsxs)("div",{className:"timeline-item",children:[(0,b.jsxs)("span",{className:"timeline-header float-right text-white ",children:["Action: ",t.action]}),(0,b.jsxs)("h3",{className:"timeline-header "+r(t.action).color,children:["User: ",(0,v.w)(t.userId,e.users)]}),(0,b.jsx)("div",{className:"timeline-header py-4",children:(0,b.jsx)("span",{dangerouslySetInnerHTML:{__html:t.comment}})}),(0,b.jsx)("div",{className:"timeline-header",children:(0,b.jsx)("span",{children:t.assignedOn?"Assigned On: "+M()(t.assignedOn).format("YYYY-MM-DD"):""})})]})]},t.id)))]},s)))})})}));var F=s(58472),Y=s(83407),R=s(76400);const P="/attachment";var B=s(3770);const z=e=>{const[t,s]=(0,n.useState)(0),[i,o]=(0,n.useState)(0),[l,c]=(0,n.useState)([]),m=new Array(i).fill(null).map(((e,t)=>t));(0,n.useEffect)((()=>{(0,B.CV)(((e,t)=>{e?console.log("err from getAttachments: ",e):(console.log("data for attachments: ",t),c(t.resp))}),5,0),o(40)}),[t]);alert("k");return(0,b.jsxs)(r.A,{className:"mb-2 shadow",children:[(0,b.jsxs)(a.A,{children:[(0,b.jsx)("i",{className:"fa fa-file"})," Attachments"]}),(0,b.jsx)(d.A,{children:(0,b.jsxs)(F.A,{responsive:!0,bordered:!0,hover:!0,children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Name"}),(0,b.jsx)("th",{children:"Type"}),(0,b.jsx)("th",{children:"Size(in KB)"}),(0,b.jsx)("th",{children:"Modified"}),(0,b.jsx)("th",{style:{width:"150px"},children:"Actions"})]})}),(0,b.jsx)("tbody",{children:l.map((e=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:e.name}),(0,b.jsx)("td",{children:e.fileType}),(0,b.jsx)("td",{children:e.size}),(0,b.jsx)("td",{children:new Date(e.updatedAt).toDateString()}),(0,b.jsx)("td",{})]},e.id)))})]})}),(0,b.jsxs)(Y.A,{children:[(0,b.jsx)("button",{onClick:()=>{s(Math.max(0,t-1))},children:"Previous"}),m.map((e=>(0,b.jsx)("button",{onClick:()=>s(e),children:e+1},e))),(0,b.jsx)("button",{onClick:()=>{s(Math.min(i-1,t+1))},children:"Next"}),(0,b.jsxs)("h3",{children:["Page of ",t+1]})]})]})};var L=s(24211),W=s(31253),U=s(43170),H=s(80688),J=s(53654),K=s.n(J),V=s(72637),q=s.n(V);const Q=(0,j.Ng)((e=>({user:e.userProfile})))((e=>{const t=e.permissions,s=e.attachments,l=A().filter(s||[],(e=>e.fileType.includes("image")&&!e.isCompressed&&!e.isEncrypted)),[c,m]=(0,n.useState)({previewFileType:null,previewFilePath:null,isPDF:!0,isImage:!0,isDropdownOpen:!1}),h=e=>{e?function(e,t){R.E8.get(`${P}/preview/${e}`).then((e=>e.data)).then((e=>{t(null,e)})).catch((e=>{t(e)}))}(e,((e,t)=>{if(!e)if(t.success){const e=(e=>{"jpg"===(e=e.toLowerCase())&&(e="jpeg");return e})(t.fileType),s=R.UB+t.filePath;m({...c,previewFileType:e,previewFilePath:s,isPDF:"pdf"===e,isImage:!1,isDropdownOpen:!1})}else window.alert(t.message)})):m({...c,isImage:!0})};return(0,b.jsxs)(r.A,{className:"shadow",children:[(0,b.jsx)(a.A,{children:(0,b.jsxs)(i.A,{children:[(0,b.jsxs)(o.A,{children:[(0,b.jsx)("i",{className:"fa fa-file"})," Preview"]}),(0,b.jsx)(o.A,{children:(0,b.jsxs)(L.A,{isOpen:c.isDropdownOpen,toggle:()=>m({...c,isDropdownOpen:!c.isDropdownOpen}),children:[(0,b.jsx)(W.A,{caret:!0,children:"Select Files"}),(0,b.jsx)(U.A,{style:{zIndex:1020,maxHeight:300,maxWidth:200,overflowY:"auto",overflowX:"hidden"},children:s.map(((e,t)=>e.fileType.includes("image")?null:(0,b.jsx)(H.A,{title:e.name,onClick:()=>h(e.id),children:e.name},t)))})]})}),(0,b.jsx)(o.A,{children:(0,b.jsxs)("span",{className:"float-right",onClick:()=>{m({...c,isImage:!c.isImage})},style:{border:"1px solid",padding:5,whiteSpace:"nowrap",cursor:"pointer",margin:3},children:[(0,b.jsx)("i",{className:"fa fa-cog"}),"Preview Images"]})})]})}),(0,b.jsxs)(d.A,{className:"w-100",children:[(0,b.jsx)("div",{id:"other-preview-container",style:{display:c.isImage?"none":"block"},children:c.isPDF&&c.previewFilePath?(0,b.jsx)("embed",{src:c.previewFilePath+"#toolbar="+String(t.download&&t.print?1:0),type:"application/pdf",width:"100%",height:"400px"}):(0,b.jsx)(K(),{fileType:c.previewFileType,filePath:c.previewFilePath,errorComponent:(0,b.jsx)("div",{children:"Error!"}),onError:()=>{}})}),(0,b.jsx)("div",{id:"image-preview-container",style:{height:400,width:"100%",textAlign:"center",alignContent:"center",display:c.isImage?"block":"none"},children:0!==l.length?(0,b.jsx)(q(),{noClose:!0,onClose:()=>m({...c,isImage:!1}),downloadable:t.download,container:document.getElementById("image-preview-container"),visible:c.isImage,images:A().map(l,(e=>({src:R.UB+e.filePath,alt:e.name})))}):null})]})]})}));var Z=s(57478),G=s(86453),X=s(46759),ee=s(80231);const te=(0,j.Ng)((e=>({users:e.allFields.users})))((e=>{const t=u.parse(e.location.search),s=x.A.getId(t["?i"]),[j,w]=(0,n.useState)({}),[v,N]=(0,n.useState)(!1),[k,I]=(0,n.useState)({}),[S,E]=(0,n.useState)(!1),[C,_]=(0,n.useState)(!1),[F,Y]=(0,n.useState)(!1),R=Number(localStorage.getItem(D.uW));(0,n.useEffect)((()=>{s?P():e.history.push(ee.A.memoList)}),[]);const P=()=>{(0,p.R0)(s,((t,s)=>{t?e.history.push(ee.A.memoList):(s.memo.workflowMasterId?(0,f.QZ)(s.memo.workflowMasterId,((e,t)=>{if(e)$.oR.error("Error!");else{I(t);const e=t.initiatorId===R&&t.assignedTo===R;Y(t.assignedTo===R&&1===t.currentLevel),_(e),E(!0)}})):_(!0),w(s.memo))}))},B=e=>{(0,p.TO)({id:j.id,formId:j.form.id,memoValues:e},((e,t)=>{e?$.oR.error("Error!"):$.oR.success("Success!")}))},L=e.permissions||{};return S?(0,b.jsxs)(b.Fragment,{children:[k.id?(0,b.jsx)(y,{workflowMaster:k}):null,(0,b.jsxs)(r.A,{className:"shadow",children:[(0,b.jsx)(a.A,{children:(0,b.jsxs)(i.A,{children:[(0,b.jsxs)(o.A,{children:[(0,b.jsxs)(l.A,{children:["Name: ",j.form.name]}),(0,b.jsx)("br",{}),(0,b.jsx)(l.A,{children:"Description:"}),(0,b.jsx)("p",{children:j.form.description})]}),(0,b.jsxs)(o.A,{children:[(0,b.jsx)(c.A,{title:"Print Report",onClick:()=>(()=>{let t="";const s=document.getElementsByTagName("link"),n=document.getElementsByTagName("style"),r=document.getElementById("form").innerHTML;if(t+=r,k.id){t+="<h3>Action Logs</h3>";const s=A().join(k.workflow_logs.map((t=>`<tr>\n                    <td>${(0,X._W)(e.users,t.userId)}</td>\n                    <td>${t.action}</td>\n                    <td>${t.comment}</td>\n                    <td>${t.assignedOn?M()(t.assignedOn).format("YYYY-MM-DD"):""}</td>\n                    <td>${M()(t.createdAt).format("YYYY-MM-DD")}</td>\n                </tr>`)),"");t+=`<table><thead><tr>\n            <th>User</th>\n            <th>Action</th>\n            <th>Comment</th>\n            <th>Assigned On</th>\n            <th>Task Completed On</th>\n            </tr>\n            </thead>\n            <tbody>${s}</tbody>\n            </table>\n            `}if(j.attachments.length>0){t+="<h3>Attachments</h3>";const s=A().join(j.attachments.map((t=>`<tr>\n                    <td>${t.name}</td>\n                    <td>${t.size}</td>\n                    <td>${M()(t.createdAt).format("YYYY-MM-DD")}</td>\n                    <td>${(0,X._W)(e.users,t.createdBy)}</td>\n                </tr>`)),"");t+=`<table><thead><tr>\n                <th>Name</th>\n                <th>Size (in KB)</th>\n                <th>Uploaded At</th>\n                <th>Uploaded By</th> \n                </tr></thead><tbody>${s}</tbody></table>`}k.workflow_users.forEach((s=>{t+=`\n      <div className="form-group float-right mt-5 mx-3">\n      <div className="mt-2" ><input style="height:100px"/></div>\n      <div className="mt-1 text-center">Authorized Signature</div>\n      <div className="mt-1 text-center">${(0,X._W)(e.users,s.userId)}</div>\n      </div>\n      `})),(0,X.p$)({links:s,styles:n,title:k.requestId||j.form.name,content:t})})(),className:"float-right mx-1",size:"sm",color:"primary",children:(0,b.jsx)("i",{className:"fa fa-print text-white"})}),(0,b.jsx)(c.A,{title:"View Attachments",onClick:()=>N(!0),className:"float-right mx-1",size:"sm",color:"info",children:(0,b.jsx)("i",{className:"fa fa-eye text-white"})})]})]})}),(0,b.jsxs)(d.A,{id:"form",children:["html"===j.form.type?(0,b.jsxs)(m.A,{onSubmit:e=>{e.preventDefault();const t=(0,G.tg)(e),s=Object.keys(t).map((e=>({name:e,value:t[e]})));C||F?B(s):$.oR.warn("You cannot edit the form!")},children:[(0,b.jsx)(Z.A,{memoValues:j.memo_values,isEdit:C,isEditBank:F,formData:j.form?j.form.formData:[]}),C||F?(0,b.jsx)(c.A,{size:"sm",color:"success",children:"Submit"}):null]}):null,"dynamic"===j.form.type?(0,b.jsx)(g.Ay.ReactFormGenerator,{onSubmit:B,answer_data:j.memo_values?j.memo_values.map((e=>({id:e.id,name:e.name,value:JSON.parse(e.value)}))):[],data:JSON.parse(j.form.formData||"{}"),read_only:!(C||F),hide_actions:!(C||F)}):null]})]}),(0,b.jsx)(h.A,{isOpen:v,toggle:()=>N(!v),children:(0,b.jsx)(Q,{attachments:j.attachments||[],permissions:L})}),(0,b.jsx)(z,{isPrimary:!0,attachments:j.attachments||[],permissions:L,memoId:j.id,loadMemo:P}),k.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(O,{workflowLogs:k.workflow_logs}),(0,b.jsx)(T,{workflowMaster:k,getData:P})]}):(0,b.jsx)(c.A,{size:"lg",color:"success",onClick:()=>{const e={memoId:s};(0,p.i3)(e,((e,t)=>{e?$.oR.warn("Oops! Something went wrong"):($.oR.success("Successful"),P())}))},children:"Start Workflow"})]}):null}))},96957:(e,t,s)=>{s.d(t,{J2:()=>o,R0:()=>l,TO:()=>d,cP:()=>c,i3:()=>a,oI:()=>i});var n=s(76400);const r="/memo",a=(e,t)=>{const s=e.memoId;n.E8.post(`${r}/start/${s}`).then((e=>t(null,e.data))).catch((e=>t(e)))},i=(e,t)=>{n.E8.post(`${r}`,e).then((e=>t(null,e.data))).catch((e=>t(e)))},o=(e,t)=>{n.E8.get(`${r}`,{params:e}).then((e=>t(null,e.data))).catch((e=>t(e)))},l=(e,t)=>{n.E8.get(`${r}/${e}`).then((e=>{t(null,e.data)})).catch((e=>t(e)))},c=(e,t)=>{n.E8.delete(`${r}/${e}`).then((e=>t(null,e.data))).catch((e=>t(e)))},d=(e,t)=>{n.E8.put(`${r}`,e).then((e=>t(null,e.data))).catch((e=>t(e)))}},57478:(e,t,s)=>{s.d(t,{A:()=>i});var n=s(65043),r=s(18039),a=s(70579);const i=e=>{const t=e.type||null,s=e.isEdit||!1,i=e.isEditBank||!1,o=e.memoValues||[],l=e.formData||"";return(0,n.useEffect)((()=>{switch(t){case r._H:break;case r.OK:const e=document.getElementById("bank-segment");e&&e.parentNode.removeChild(e)}o.forEach((e=>{let{name:t,value:n}=e;const r=document.getElementsByName(t);0!==r.length&&r.forEach((e=>{switch(console.log(s,i),s||i&&"bank-segment"===e.parentNode.id?e.setAttribute("name",t):(e.setAttribute("readonly","readonly"),e.removeAttribute("name")),e.type){case"checkbox":"true"===n?e.setAttribute("checked",!0):e.removeAttribute("checked");break;case"radio":JSON.stringify(e.value)===n&&e.setAttribute("checked",!0);break;default:const t=n.slice(1,-1);e.setAttribute("value",t),e.value=JSON.parse(n)}}))}))}),[o,s,t]),(0,a.jsx)("div",{id:"html-form-segment",className:"my-2",dangerouslySetInnerHTML:{__html:l}})}},68499:(e,t,s)=>{s.d(t,{Dn:()=>l,KK:()=>a,Mw:()=>i,QZ:()=>o});var n=s(76400);const r="/workflow",a=(e,t)=>{n.E8.put(`${r}/${e.id}`,e).then((e=>t(null,e.data))).catch((e=>t(e)))},i=(e,t)=>{n.E8.get(`${r}/${e}`).then((e=>t(null,e.data))).catch((e=>t(e)))},o=(e,t)=>{n.E8.get(`${r}/master/${e}`).then((e=>t(null,e.data))).catch((e=>t(e)))},l=(e,t)=>{n.E8.post(`${r}/submit/${e.action}`,e.data).then((e=>t(null,e.data))).catch((e=>t(e)))}},67735:(e,t,s)=>{s.d(t,{a:()=>i,w:()=>a});var n=s(68499),r=s(28096);const a=(e,t)=>{let s={};return t&&t.forEach((t=>{t.id===e&&(s=t)})),s.name||""},i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};(0,n.Dn)({action:"skip",data:{comment:"",workflowMasterId:e}},((e,s)=>{e?r.oR.error("Error!"):(r.oR.success("Success!"),t())}))}}}]);
//# sourceMappingURL=9117.a69b1cf5.chunk.js.map