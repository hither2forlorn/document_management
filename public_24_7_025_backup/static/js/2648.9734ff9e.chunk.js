"use strict";(self.webpackChunkgeneral_dms=self.webpackChunkgeneral_dms||[]).push([[2648],{25241:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var a=n(65043),s=n(94281),l=n(86453),i=n(70579);const o=e=>(0,i.jsx)("div",{style:{height:"40vh",textAlign:"center",paddingTop:100},children:e.children}),r=e=>{const t=0!==e.selectedFiles.length,n=(0,a.useCallback)((t=>{Promise.all(t.map((e=>new Promise((t=>{const n=new FileReader;n.onload=n=>{t({id:Date.now(),src:n.target.result,type:e.type,name:e.name,file:{originalname:e.name,size:e.size,mimetype:e.type}})},n.readAsDataURL(e)})).catch((e=>{}))))).then((t=>{e.setSelectedFiles([{document:{identifier:(0,l.Cm)()},attachments:t}])}))}),[]),{getRootProps:r,getInputProps:c,isDragActive:d}=(0,s.VB)({onDrop:n,...t?{noClick:!0,noKeyboard:!0}:{}});return(0,i.jsxs)("div",{...r(),style:{border:"dashed 1px #ccc",background:"white"},children:[(0,i.jsx)("input",{...c()}),d?(0,i.jsx)(o,{children:(0,i.jsx)("h4",{children:"Drop here"})}):t?null:(0,i.jsxs)(o,{children:[(0,i.jsx)("h5",{children:"Drag 'n' drop some files here, or click to select files"}),(0,i.jsx)("img",{src:"img/upload.svg",alt:"upload image",width:"100",height:"100",className:"align-center"})]}),e.children]})};var c=n(94576),d=n(75304),m=n(25852),u=n(13718),h=n(44864),p=n(32936),x=n(64545),g=n(54798),j=n(87382),f=n(38477),v=n(83407),y=n(53536),C=n.n(y),b=n(55406),A=n.n(b);n(12704);class I extends a.Component{constructor(){super(...arguments),this.state={imageElement:a.createRef(),image:this.props.image,cropper:{}},this.onSubmit=()=>{const e=this.state.imgDes;this.props.onCrop({...this.state.image,src:e})}}componentDidMount(){console.log(this.state.imageElement);const e=new(A())(this.state.imageElement.current,{zoomable:!0,scalable:!0,aspectRatio:NaN,crop:()=>{const t=e.getCroppedCanvas();this.setState({imgDes:t.toDataURL()})}});this.setState({cropper:e,image:this.props.image})}render(){return(0,i.jsxs)(d.A,{children:[(0,i.jsx)(f.A,{children:(0,i.jsxs)(m.A,{children:[(0,i.jsx)(u.A,{children:"Card title"}),(0,i.jsx)(u.A,{children:(0,i.jsx)(j.A,{className:"float-right",onClick:this.props.onCancel,size:"sm",color:"danger",children:(0,i.jsx)("i",{className:"fa fa-remove"})})})]})}),(0,i.jsx)(h.A,{children:(0,i.jsxs)(m.A,{children:[(0,i.jsx)(u.A,{children:(0,i.jsx)("img",{className:"img-fluid",ref:this.state.imageElement,src:this.state.image.src,alt:"source"})}),(0,i.jsx)(u.A,{children:(0,i.jsx)("img",{className:"img-fluid",src:this.state.imgDes,alt:"Destination"})})]})}),(0,i.jsxs)(v.A,{className:"w-100 text-center",children:[(0,i.jsx)(j.A,{onClick:this.props.onCancel,className:"float-left m-2",size:"sm",color:"warning",children:"Cancel"}),(0,i.jsx)(j.A,{onClick:()=>this.state.cropper.crop(),className:"m-2",size:"sm",color:"info",children:(0,i.jsx)("i",{className:"text-white fa fa-crop"})}),(0,i.jsx)(j.A,{onClick:()=>this.state.cropper.rotate(-90),className:"m-2",size:"sm",color:"info",children:(0,i.jsx)("i",{className:"text-white fa fa-rotate-left"})}),(0,i.jsx)(j.A,{onClick:()=>this.state.cropper.rotate(90),className:"m-2",size:"sm",color:"info",children:(0,i.jsx)("i",{className:"text-white fa fa-rotate-right"})}),(0,i.jsx)(j.A,{onClick:this.onSubmit,className:"float-right m-2",size:"sm",color:"success",children:"Complete"})]})]})}}const k=I;var N=n(34057),D=n(15982),w=n(28096),V=n(76400),F=n(97508),S=n(19368),T=n(80231);const E="card";var R=n(97956),L=n(80043),z=n(15421),O=n(81078),P=n(16393);function B(){document.getElementById("loading").style.display="none"}const _=e=>{let t=e.document||{};const n=e.securityLevels;let s=e.checkerList;2==e.document.securityLevel&&(s=s.filter((e=>e.departmentId==t.departmentId)));const l=e.document.index;e.users.forEach((e=>{e.label=e.name,e.value=e.id}));const[o,r]=(0,a.useState)(t.documentTypeId?String(t.documentTypeId):""),[p,x]=(0,a.useState)(e),[g,j]=a.useState({}),f=t=>{t.preventDefault();const n=t.target.value?t.target.value:t.target.checked;e.onChange({name:t.target.name,value:n,index:l})};return(0,i.jsx)(c.A,{children:(0,i.jsx)(d.A,{children:(0,i.jsxs)(m.A,{children:[(0,i.jsx)(u.A,{md:7,children:(0,i.jsxs)(h.A,{className:"component-content-container",children:[(0,i.jsx)("input",{className:"d-none",type:"text",name:"index",defaultValue:l}),(0,z.onlyForThisVendor)(z.banks.bok.name)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(O.A,{label:"BOK ID",value:"BOK",generateUserFromCBS:async(t,n)=>{"BOK"!==t&&(j(n),n.name=n.BOKID,n.approved_date=(0,P.i)(n.ApprovedDate),n.url=n.URL,n.customer_name=n.CustName,n.isApproved=!0,n.otherTitle=(null===n||void 0===n?void 0:n.BOKID)+"-"+(null===n||void 0===n?void 0:n.CustName)+"-"+(null===n||void 0===n?void 0:n.ApprovedDate)+"-"+(null===n||void 0===n?void 0:n.CPRno),e.onChange({name:"all_values",value:n,index:l,add_all_value:!0}))},name:"name",onChange:f,documentFormBata:!0}),(0,i.jsx)(S.wi,{required:!0,label:"Customer Name",defaultValue:null===g||void 0===g?void 0:g.CustName,name:"customer_name",readOnly:!0}),(0,i.jsx)(S.wi,{type:"date",defaultValue:(0,P.i)(g.ApprovedDate),label:"Approved Date",name:"approved_date",readOnly:!0}),(0,i.jsx)(S.wi,{defaultValue:null===g||void 0===g?void 0:g.URL,label:"URL",name:"url",readOnly:!0}),(0,i.jsx)(S.wi,{defaultValue:null===g||void 0===g?void 0:g.CPRno,label:"TBOKID",name:"CPRno",readOnly:!0}),(0,i.jsx)(S.wi,{required:!0,label:"Document Name",name:"otherTitle",readOnly:(0,z.onlyForThisVendor)(z.banks.bok.name),defaultValue:(null===g||void 0===g?void 0:g.BOKID)&&(null===g||void 0===g?void 0:g.CustName)&&(null===g||void 0===g?void 0:g.ApprovedDate)&&(null===g||void 0===g?void 0:g.CPRno)&&(null===g||void 0===g?void 0:g.BOKID)+"-"+(null===g||void 0===g?void 0:g.CustName)+"-"+(null===g||void 0===g?void 0:g.ApprovedDate)+"-"+(null===g||void 0===g?void 0:g.CPRno),onChange:e.handleChange})]}),(0,i.jsx)(S.wi,{object:t,isEdit:!0,label:"Identifier",name:"identifier",value:t.identifier,readOnly:!0}),(0,z.onlyForThisVendor)([z.banks.rbb.name,z.banks.citizen.name])&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(S.wi,{required:!0,object:t,isEdit:!0,label:"Document Name",name:"otherTitle",onChange:f})}),(0,i.jsx)(S.Ae,{label:"Language",name:"languageId",options:p.languages,object:t,isEdit:!0,hasDefaultValue:!0,defaultValue:!0,onChange:f}),(0,i.jsx)(S.Ae,{label:"Document Condition",name:"documentConditionId",options:p.documentConditions,object:t,hasDefaultValue:!0,defaultValue:!0,isEdit:!0,onChange:f}),(0,i.jsx)(S.Ae,{required:!0,label:"Status",name:"statusId",options:e.statuses,hasDefaultValue:!0,defaultValue:!0,object:t,isEdit:!0,onChange:f}),(0,i.jsx)(S.Ae,{required:!0,label:"Location Map",name:"locationMapId",options:e.locationMaps,object:t,isEdit:!0,defaultValue:e.defaultValues.locationMapId?e.defaultValues.locationMapId:null,onChange:f}),e.defaultValues.branchId?"":(0,i.jsx)(S.Ae,{label:"Department",name:"departmentId",options:e.departments,object:t,isEdit:!0,defaultValue:e.defaultValues.departmentId?e.defaultValues.departmentId:null,required:2==t.securityLevel,onChange:f}),e.defaultValues.departmentId?"":(0,i.jsx)(S.Ae,{label:"Branch",name:"branchId",options:e.branches,object:t,isEdit:!0,defaultValue:e.defaultValues.branchId?e.defaultValues.branchId:null,onChange:f}),!e.document.hierarchy&&(0,i.jsx)(S.Ae,{label:"Security Level",name:"securityLevel",options:n,object:t,isEdit:!0,defaultValue:e.defaultValues.securityLevel?e.defaultValues.securityLevel:null,onChange:f}),4==t.securityLevel&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(u.A,{md:7,children:(0,i.jsx)(S.Ae,{label:"User Group",name:"userGroupId",required:!0,options:e.userGroup,onChange:e.handleChange})})}),!e.document.securityLevel&&(0,i.jsx)(S.Ae,{label:"Security Hierarchy",name:"hierarchy",options:e.hierarchy,object:t,isEdit:!0,onChange:f,defaultValue:e.defaultValues.hierarchy?e.defaultValues.hierarchy:null}),(0,i.jsx)(u.A,{md:7,children:(0,i.jsxs)(m.A,{children:[(0,i.jsx)(u.A,{md:4,children:(0,i.jsx)(S.wi,{isEdit:!0,type:"checkbox",name:"isArchived",onChange:f,value:!0,children:"Archive"})}),(0,i.jsx)(u.A,{md:4,children:(0,i.jsx)(S.wi,{isEdit:!0,type:"checkbox",name:"hasOtp",onChange:f,children:"Require OTP Verification"})})]})}),(0,i.jsx)(S.Ae,{required:!0,object:t,label:"Checker",name:"checker",options:s,isEdit:!0,onChange:f})]})}),(0,i.jsx)(u.A,{md:5,children:(0,i.jsx)(L.A,{...e,setIndexValues:t=>{e.documentSetIndex({documentIndexList:t}),e.onChange({name:"documentIndex",value:t,index:l})},noValidationCondition:!0,indexValues:e.document.documentIndex,handleDocumentTypeChange:t=>{r(t.target.value),e.onChange({name:t.target.name,value:t.target.value,index:l})},documentTypeId:o,fromBulkAttachmentUploads:!0})})]})})})},M=e=>{const{image:t,childIndex:n,parentIndex:a,setSelectedImage:s,moveCard:l}=e,[{isDragging:o},r]=(0,N.i)({item:{type:E,image:t},collect:e=>({isDragging:!!e.isDragging()})}),[,c]=(0,D.H)({accept:E,hover:(e,s)=>{s.isOver({shallow:!0});const i=e.image.index,o=t.index;l(i,o,n,a),i!==o&&(e.image.index=o)}});return(0,i.jsx)("div",{ref:c,children:(0,i.jsxs)("div",{className:"m-2",style:{contain:"content",opacity:o?.3:1,cursor:"move",transition:"0.1s",height:160,width:130,objectFit:"cover",border:"1px solid grey",boxShadow:"6px 6px #e0dada",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},ref:r,children:[t.type.includes("image")?(0,i.jsx)(U,{drop:c,drag:r,isDragging:o,image:{...t,index:n},onClickImage:e=>s({...e,parentIndex:a})}):(0,i.jsx)(K,{attachment:t}),e.children]})})},U=e=>{const t=e.image,n=t.name;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{className:"img-fluid",onClick:()=>e.onClickImage(t),src:t.src,alt:t.name}),(0,i.jsx)("span",{children:n})]})},K=e=>{const t=e.attachment||{},n=t.name.split(".").pop();return(0,i.jsx)(i.Fragment,{children:"pdf"===n||"PDF"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{className:" fa fa-file-pdf",style:{fontSize:"5rem",color:"rgb(232 85 65)"}}),(0,i.jsx)("p",{style:{width:"90%",marginTop:"1rem"},children:t.name})]}):"docx"===n||"DOCX"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{className:" fa fa-file-word",style:{fontSize:"5rem",color:"#0000FF"}}),(0,i.jsx)("p",{style:{width:"90%",marginTop:"1rem"},children:t.name})]}):"xls"===n||"XLS"===n||"xlsx"===n||"XLSX"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{style:{fontSize:"5rem",color:"#1E6E42"},className:"fa fa-file-excel"}),(0,i.jsx)("p",{style:{width:"90%",marginTop:"1rem"},children:t.name})]}):"txt"===n||" TXT"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{style:{fontSize:"5rem",color:"#ccc"},className:"fa fa-file-text-o"}),(0,i.jsx)("p",{style:{width:"90%",marginTop:"1rem"},children:t.name})]}):"mp4"===n||"mkv"===n||"flv"===n||"3gp"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{style:{fontSize:"5rem",color:"#ccc"},className:"fa fa-file-video"}),(0,i.jsx)("p",{style:{width:"90%",marginTop:"1rem"},children:t.name})]}):"mp3"===n||"aac"===n||"wav"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{style:{fontSize:"5rem",color:"#ccc"},className:"fa fa-music"}),(0,i.jsx)("p",{style:{width:"90%",marginTop:"1rem"},children:t.name})]}):null})},q=(0,F.Ng)((e=>({allFields:e.allFields,userProfile:e.userProfile})))((e=>{const[t,n]=(0,a.useState)([]),[s,o]=(0,a.useState)({}),[c,m]=(0,a.useState)(),[u,y]=(0,a.useState)([]),b=(e,a,s,l)=>{n([...t.map(((t,n)=>n===l?{document:t.document,attachments:t.attachments.map(((t,n,s)=>{let l;return l=e<a?n===a?s[e]:n>=e&&n<a?s[n+1]:t:n===a?s[e]:n<=e&&n>a?s[n-1]:t,l||t}))}:t))])};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(p.A,{isOpen:!!c,toggle:()=>m(!1),children:[(0,i.jsx)(x.A,{children:(0,i.jsx)(_,{document:c,documentSetIndex:y,onChange:e=>{let{name:a,value:s,index:l,add_all_value:i}=e;const o=C().map(t,((e,t)=>{if(Number(l)===t){const t={...e.document,...i?s:{[a]:s}};return m({...t,index:l}),{document:t,attachments:e.attachments}}return e}));n([...o])},...e.allFields})}),(0,i.jsx)(g.A,{children:(0,i.jsx)(j.A,{color:"primary",size:"sm",onClick:()=>m(!1),children:"Done"})})]}),(0,i.jsx)(r,{setSelectedFiles:n,selectedFiles:t,children:0!==t.length?(0,i.jsxs)(i.Fragment,{children:[s.src?(0,i.jsx)(k,{image:s,onCancel:()=>o({}),onCrop:e=>{const a=Number(e.parentIndex),s=t.map(((t,n)=>n===a?{document:t.document,attachments:t.attachments?t.attachments.map((t=>t.name===e.name?e:t)):[]}:t));o({}),n([...s])}}):null,t.map(((e,a)=>(0,i.jsxs)(d.A,{children:[(0,i.jsxs)(f.A,{className:"d-flex",children:["Document (Please all required fields * )"," ",!e.document.identifier||!e.document.documentTypeId||(0,z.onlyForThisVendor)(z.banks.rbb.name)&&!e.document.otherTitle||!e.document.locationMapId||!e.document.documentTypeId||(0,z.onlyForThisVendor)(z.banks.bok.name)&&!e.document.securityLevel?(0,i.jsx)("p",{className:"text-danger ml-2 h5",children:"Not Indexed"}):(0,i.jsx)("p",{className:"text-success ml-2 h5",children:"Indexed"})]}),(0,i.jsx)(h.A,{children:(0,i.jsx)("div",{style:{flex:1,flexWrap:"wrap",display:"flex"},children:e.attachments.map(((s,r)=>(0,i.jsxs)("div",{className:"d-flex",children:[(0,i.jsx)(M,{childIndex:r,parentIndex:a,setSelectedImage:o,moveCard:b,image:{...s,index:r}},r)," ",e.attachments.length-1===r?null:(0,i.jsx)(j.A,{size:"sm",color:"white",onClick:()=>((e,a)=>{const s=C().filter(t,((t,n)=>n<e?1:0)),i=C().filter(t,((t,n)=>n>e?1:0)),o=t[e],r=[...s,{document:o.document,attachments:C().filter(o.attachments,((e,t)=>t<=a?1:0))},{document:{identifier:(0,l.Cm)()},attachments:C().filter(o.attachments,((e,t)=>t>a?1:0))},...i];n(r)})(a,r),children:(0,i.jsx)("i",{className:"fa fa-caret-right fa-2x"})})]},r)))})}),(0,i.jsxs)(v.A,{className:"d-flex justify-content-end",children:[t.length-1===a?null:(0,i.jsx)(j.A,{size:"sm",color:"primary",onClick:()=>(e=>{const a=[];for(let n=0;n<t.length;n++)e===n?(a.push({document:t[n].document,attachments:[...t[n].attachments,...t[n+1].attachments]}),n++):a.push(t[n]);n(a)})(a),className:"mr-1",children:"Join"}),(0,i.jsx)(j.A,{color:"primary",size:"sm",onClick:()=>m({index:a,...e.document||{}}),children:"Index"})]})]},a))),(0,i.jsxs)("div",{className:"d-flex justify-content-end mb-4 mr-4",children:[(0,i.jsx)(R.A,{onClick:()=>n([])}),(0,i.jsx)(j.A,{onClick:()=>{let n=!1;if(t.forEach((e=>{(0,z.includeThisFeature)(z.dms_features.DEFAULT_MAKER_CHECKER_DOCUMENTS)&&(e.document.checker||(w.oR.warn("Please select checker!"),n=!0),e.document.locationMapId||(w.oR.warn("Please select location Map!"),n=!0),e.document.documentTypeId||(w.oR.warn("Please select Document Type"),n=!0),e.document.otherTitle||(w.oR.warn("Please provide Document Name"),n=!0))})),n)return;let a=!0;t.forEach((e=>{let{document:t}=e;t.identifier&&t.documentTypeId&&(!(0,z.onlyForThisVendor)(z.banks.bok.name)||t.securityLevel)||(a=!1)})),a?(document.getElementById("loading").style.display="unset",t.forEach((e=>{e.document.checker&&(e.document.checker=[{userId:e.document.checker,isApprover:!0}])})),console.log(t,"this is selected files"),V.E8.post("/attachment/bulk-attachment-upload",{selectedFiles:t},{onUploadProgress:e=>{parseInt(Math.round(e.loaded/e.total*100))}}).then((t=>{console.log(t),window.location.reload(),B(),w.oR.success("Success!"),e.history.push(T.A.BulkAttachmentUpload)})).catch((e=>{console.log(e.response),409===e.response.status?(w.oR.error(e.response.data),B()):(B(),w.oR.error("Error!"))}))):w.oR.warn("You have not indexed the document!")},size:"md",color:"success",children:"Submit"})]})]}):null})]})}))},16393:(e,t,n)=>{function a(e){return e?e.split("/").reverse().join("-"):null}n.d(t,{i:()=>a})}}]);
//# sourceMappingURL=2648.9734ff9e.chunk.js.map