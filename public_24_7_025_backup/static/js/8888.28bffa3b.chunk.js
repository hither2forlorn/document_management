"use strict";(self.webpackChunkgeneral_dms=self.webpackChunkgeneral_dms||[]).push([[8888],{8888:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Z});var a=t(65043),r=t(75304),l=t(38477),n=t(25852),i=t(13718),o=t(8586),c=t(87382),d=t(44864),m=t(94576),p=t(32936),h=t(83565),u=t(58441),f=t(56253),g=t(34511),b=t(28096),x=t(58472),j=t(58168),y=t(64467),w=t(98587),v=t(65173),A=t.n(v),O=t(98139),N=t.n(O),k=t(62373),S=["children","className","barClassName","cssModule","value","min","max","animated","striped","color","bar","multi","tag","style","barStyle","barAriaValueText","barAriaLabelledBy"];function I(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,a)}return t}function E(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?I(Object(t),!0).forEach((function(s){(0,y.A)(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}var P={children:A().node,bar:A().bool,multi:A().bool,tag:k.Wx,value:A().oneOfType([A().string,A().number]),min:A().oneOfType([A().string,A().number]),max:A().oneOfType([A().string,A().number]),animated:A().bool,striped:A().bool,color:A().string,className:A().string,barClassName:A().string,cssModule:A().object,style:A().object,barStyle:A().object,barAriaValueText:A().string,barAriaLabelledBy:A().string},T=function(e){var s=e.children,t=e.className,r=e.barClassName,l=e.cssModule,n=e.value,i=e.min,o=e.max,c=e.animated,d=e.striped,m=e.color,p=e.bar,h=e.multi,u=e.tag,f=e.style,g=e.barStyle,b=e.barAriaValueText,x=e.barAriaLabelledBy,y=(0,w.A)(e,S),v=(0,k.Ro)(n)/(0,k.Ro)(o)*100,A=(0,k.qO)(N()(t,"progress"),l),O={className:(0,k.qO)(N()("progress-bar",p&&t||r,c?"progress-bar-animated":null,m?"bg-"+m:null,d||c?"progress-bar-striped":null),l),style:E(E(E({},p?f:{}),g),{},{width:v+"%"}),role:"progressbar","aria-valuenow":n,"aria-valuemin":i,"aria-valuemax":o,"aria-valuetext":b,"aria-labelledby":x,children:s};return p?a.createElement(u,(0,j.A)({},y,O)):a.createElement(u,(0,j.A)({},y,{style:f,className:A}),h?s:a.createElement("div",O))};T.propTypes=P,T.defaultProps={tag:"div",value:0,min:0,max:100,style:{},barStyle:{}};const F=T;var C=t(55242);const D="/client/attachment";var R=t(70579);const M=e=>{const s=e.attachments,t=e.isPrimary,[n,i]=(0,a.useState)({loading:null,selectedFiles:[]});const o=s=>{e.permissions.download?window.confirm("Do you want to download the file?")&&(document.getElementById("loading").style.display="unset",function(e,s){C.E8.get(`${D}/download/${e}`).then((e=>e.data)).then((e=>{s(null,e)})).catch((e=>{s(e)}))}(s,((e,s)=>{if(s.success){const e=C.UB+"/"+s.file,t=document.createElement("a");t.style.display="none",t.href=e,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else b.oR.warn(s.message);document.getElementById("loading").style.display="none"}))):window.alert("Not allowed to download the file!")};return(0,R.jsxs)(r.A,{className:"mb-2",children:[(0,R.jsxs)(l.A,{children:[(0,R.jsx)("i",{className:"fa fa-file"})," Attachments"]}),(0,R.jsxs)(d.A,{children:[(0,R.jsxs)(x.A,{responsive:!0,children:[(0,R.jsx)("thead",{children:(0,R.jsxs)("tr",{children:[(0,R.jsx)("th",{children:"Name"}),(0,R.jsx)("th",{children:"Type"}),(0,R.jsx)("th",{children:"Size(in KB)"}),(0,R.jsx)("th",{children:"Modified"}),(0,R.jsx)("th",{style:{width:"150px"},children:"Actions"})]})}),(0,R.jsx)("tbody",{children:s.map((e=>(0,R.jsxs)("tr",{children:[t?(0,R.jsx)("td",{style:{color:"#00e",cursor:"pointer"},onClick:()=>o(e.id),children:e.name}):(0,R.jsx)("td",{children:e.name}),(0,R.jsx)("td",{children:e.fileType}),(0,R.jsx)("td",{children:e.size}),(0,R.jsx)("td",{children:new Date(e.updatedAt).toDateString()}),t?(0,R.jsx)("td",{style:{cursor:"pointer"},onClick:()=>(e.id,void b.oR.warn("You cannot delete the file")),children:(0,R.jsx)("i",{className:"fa fa-trash"})}):(0,R.jsx)("td",{})]},e.id)))})]}),t?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:"custom-file mb-4",style:{zIndex:0},children:[(0,R.jsx)("input",{onChange:e=>{i({...n,selectedFiles:e.target.files})},multiple:!0,type:"file",className:"custom-file-input",name:"file",id:"file","aria-describedby":"inputGroupFileAddon01"}),(0,R.jsx)("label",{style:{cursor:"pointer"},className:"custom-file-label",id:"file-label",htmlFor:"file",children:n.selectedFiles&&0!==n.selectedFiles.length?Object.values(n.selectedFiles).map((e=>e.name+", ")):"Choose a file..."})]}),null!==n.loading?(0,R.jsx)(F,{id:"progress-bar",value:n.loading}):null,(0,R.jsx)("div",{className:"component-button-container",children:(0,R.jsxs)("button",{onClick:()=>(s=>{if(n.selectedFiles.length>0){const a=new FormData;for(var t in a.append("fileType",s),a.append("itemId",e.memoId),a.append("itemType","memo"),n.selectedFiles)a.append("file",n.selectedFiles[t]);i({...n,loading:0}),C.E8.post("/client/attachment",a,{onUploadProgress:e=>{const s=parseInt(Math.round(e.loaded/e.total*100));i({loading:s})}}).then((s=>{e.loadMemo(),i({...n,selectedFiles:[],loading:null})})).catch((e=>{i({...n,selectedFiles:[],loading:null})}))}else b.oR.warn("No files selected!")})(),children:[(0,R.jsx)("i",{className:"fa fa-check"}),"Upload"]})})]}):null]})]})};var _=t(24211),B=t(31253),$=t(43170),z=t(80688),L=t(53536),V=t.n(L),J=t(53654),U=t.n(J),q=t(72637),K=t.n(q),W=t(97508);const H=(0,W.Ng)((e=>({user:e.userProfile})))((e=>{const s=e.permissions,t=e.attachments,o=V().filter(t||[],(e=>e.fileType.includes("image")&&!e.isCompressed&&!e.isEncrypted)),[c,m]=(0,a.useState)({previewFileType:null,previewFilePath:null,isPDF:!0,isImage:!0,isDropdownOpen:!1}),p=e=>{e?function(e,s){C.E8.get(`${D}/preview/${e}`).then((e=>e.data)).then((e=>{s(null,e)})).catch((e=>{s(e)}))}(e,((e,s)=>{if(!e)if(s.success){const e=(e=>{"jpg"===(e=e.toLowerCase())&&(e="jpeg");return e})(s.fileType),t=C.UB+s.filePath;m({...c,previewFileType:e,previewFilePath:t,isPDF:"pdf"===e,isImage:!1,isDropdownOpen:!1})}else window.alert(s.message)})):m({...c,isImage:!0})};return(0,R.jsxs)(r.A,{children:[(0,R.jsx)(l.A,{children:(0,R.jsxs)(n.A,{children:[(0,R.jsxs)(i.A,{children:[(0,R.jsx)("i",{className:"fa fa-file"})," Preview"]}),(0,R.jsx)(i.A,{children:(0,R.jsxs)(_.A,{isOpen:c.isDropdownOpen,toggle:()=>m({...c,isDropdownOpen:!c.isDropdownOpen}),children:[(0,R.jsx)(B.A,{caret:!0,children:"Select Files"}),(0,R.jsx)($.A,{style:{zIndex:1020,maxHeight:300,maxWidth:200,overflowY:"auto",overflowX:"hidden"},children:t.map(((e,s)=>e.fileType.includes("image")?null:(0,R.jsx)(z.A,{title:e.name,onClick:()=>p(e.id),children:e.name},s)))})]})}),(0,R.jsx)(i.A,{children:(0,R.jsxs)("span",{className:"float-right",onClick:()=>{m({...c,isImage:!c.isImage})},style:{border:"1px solid",padding:5,whiteSpace:"nowrap",cursor:"pointer",margin:3},children:[(0,R.jsx)("i",{className:"fa fa-cog"}),"Preview Images"]})})]})}),(0,R.jsxs)(d.A,{className:"w-100",children:[(0,R.jsx)("div",{id:"other-preview-container",style:{display:c.isImage?"none":"block"},children:c.isPDF&&c.previewFilePath?(0,R.jsx)("embed",{src:c.previewFilePath+"#toolbar="+String(s.download?1:0),type:"application/pdf",width:"100%",height:"400px"}):(0,R.jsx)(U(),{fileType:c.previewFileType,filePath:c.previewFilePath,errorComponent:(0,R.jsx)("div",{children:"Error!"}),onError:()=>{}})}),(0,R.jsx)("div",{id:"image-preview-container",style:{height:400,width:"100%",textAlign:"center",alignContent:"center",display:c.isImage?"block":"none"},children:0!==o.length?(0,R.jsx)(K(),{noClose:!0,onClose:()=>m({...c,isImage:!1}),downloadable:s.download,container:document.getElementById("image-preview-container"),visible:c.isImage,images:V().map(o,(e=>({src:C.UB+e.filePath,alt:e.name})))}):null})]})]})}));var Y=t(29920),G=t(72270),X=t(86453),Q=t(18039);const Z=(0,W.Ng)((e=>({users:e.allFields.users})))((e=>{const s=h.parse(e.location.search),t=u.A.getId(s["?i"]),[x,j]=(0,a.useState)({}),[y,w]=(0,a.useState)(!1),[v,A]=(0,a.useState)(!1),[O,N]=(0,a.useState)(!1);(0,a.useEffect)((()=>{t?k():e.history.push(G.A.clientMemoList)}),[]);const k=()=>{(0,g.R0)(t,((s,t)=>{s?e.history.push(G.A.clientMemoList):(j(t.memo),t.memo.workflowMasterId?N(t.memo.workflow_master.assignedTo===t.memo.workflow_master.initiatorId):N(!0),A(!0))}))},S=e=>{(0,g.TO)({id:x.id,formId:x.form.id,memoValues:e},((e,s)=>{e?b.oR.error("Error!"):b.oR.success("Success!")}))},I=e.permissions||{};return v?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(r.A,{children:[(0,R.jsx)(l.A,{children:(0,R.jsxs)(n.A,{children:[(0,R.jsxs)(i.A,{children:[(0,R.jsxs)(o.A,{children:["Name: ",x.form.name]}),(0,R.jsx)("br",{}),(0,R.jsx)(o.A,{children:"Description:"}),(0,R.jsx)("p",{children:x.form.description})]}),(0,R.jsx)(i.A,{children:(0,R.jsx)(c.A,{title:"View Attachments",onClick:()=>w(!0),className:"float-right mx-1",size:"sm",color:"info",children:(0,R.jsx)("i",{className:"fa fa-eye text-white"})})})]})}),(0,R.jsxs)(d.A,{id:"form",children:["html"===x.form.type?(0,R.jsxs)(m.A,{onSubmit:e=>{e.preventDefault();const s=(0,X.tg)(e),t=Object.keys(s).map((e=>({name:e,value:s[e]})));O?S(t):b.oR.warn("You cannot edit the form!")},children:[(0,R.jsx)(Y.A,{type:Q.OK,memoValues:x.memo_values,isEdit:O,formData:x.form?x.form.formData:[]}),O?(0,R.jsxs)(c.A,{type:"submit",size:"sm",className:"text-white mt-2",color:"info",children:[(0,R.jsx)("i",{className:"fa fa-save"})," Save as draft"]}):null]}):null,"dynamic"===x.form.type?(0,R.jsx)(f.Ay.ReactFormGenerator,{onSubmit:S,answer_data:x.memo_values?x.memo_values.map((e=>({id:e.id,name:e.name,value:JSON.parse(e.value)}))):[],data:JSON.parse(x.form.formData||"{}"),action_name:"Save as Draft",read_only:!O,hide_actions:!O}):null]})]}),(0,R.jsx)(p.A,{isOpen:y,toggle:()=>w(!y),children:(0,R.jsx)(H,{attachments:x.attachments||[],permissions:I,isPrimary:!1})}),(0,R.jsx)(M,{isPrimary:!0,attachments:x.attachments||[],permissions:I,memoId:x.id,loadMemo:k}),x.workflowMasterId?null:(0,R.jsx)(c.A,{size:"lg",color:"success",onClick:()=>{const e={memoId:t};(0,g.Cc)({data:e,action:"start"},((e,s)=>{e?b.oR.warn("Oops! Something went wrong"):(b.oR.success("Successful"),k())}))},children:"Proceed"}),x.workflow_master&&x.workflow_master.assignedTo===x.createdBy?(0,R.jsx)(c.A,{size:"lg",color:"success",onClick:()=>{const e={memoId:t,workflowMasterId:x.workflowMasterId};(0,g.Cc)({data:e,action:"submit"},((e,s)=>{e?b.oR.warn("Oops! Something went wrong"):(b.oR.success("Successful"),k())}))},children:"Proceed"}):null]}):null}))},34511:(e,s,t)=>{t.d(s,{Cc:()=>l,Kf:()=>i,R0:()=>o,TO:()=>c,oI:()=>n});var a=t(55242);const r="/client/memo",l=(e,s)=>{let{data:t,action:l}=e;const n=t.memoId;a.E8.post(`${r}/${l}/${n}`,t).then((e=>s(null,e.data))).catch((e=>s(e)))},n=(e,s)=>{a.E8.post(`${r}`,e).then((e=>s(null,e.data))).catch((e=>s(e)))},i=(e,s)=>{a.E8.get(`${r}`,{params:e}).then((e=>s(null,e.data))).catch((e=>s(e)))},o=(e,s)=>{a.E8.get(`${r}/${e}`).then((e=>s(null,e.data))).catch((e=>s(e)))},c=(e,s)=>{a.E8.put(`${r}`,e).then((e=>s(null,e.data))).catch((e=>s(e)))}},29920:(e,s,t)=>{t.d(s,{A:()=>n});var a=t(65043),r=t(18039),l=t(70579);const n=e=>{const s=e.type||null,t=e.isEdit||!1,n=e.memoValues||[],i=e.formData||"";return(0,a.useEffect)((()=>{switch(s){case r._H:break;case r.OK:const e=document.getElementById("bank-segment");e&&e.parentNode.removeChild(e)}n.forEach((e=>{let{name:s,value:t}=e;const a=document.getElementsByName(s);0!==a.length&&a.forEach((e=>{switch(e.value=JSON.parse(t),e.checked=JSON.parse(t),e.type){case"checkbox":"true"===t?e.setAttribute("checked",!0):e.removeAttribute("checked");break;case"radio":JSON.stringify(e.value)===t&&e.setAttribute("checked",!0);break;default:e.value=JSON.parse(t)}}))}))}),[n,t,s]),(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:i}})}},58472:(e,s,t)=>{t.d(s,{A:()=>u});var a=t(58168),r=t(98587),l=t(65043),n=t(65173),i=t.n(n),o=t(98139),c=t.n(o),d=t(62373),m=["className","cssModule","size","bordered","borderless","striped","dark","hover","responsive","tag","responsiveTag","innerRef"],p={className:i().string,cssModule:i().object,size:i().string,bordered:i().bool,borderless:i().bool,striped:i().bool,dark:i().bool,hover:i().bool,responsive:i().oneOfType([i().bool,i().string]),tag:d.Wx,responsiveTag:d.Wx,innerRef:i().oneOfType([i().func,i().string,i().object])},h=function(e){var s=e.className,t=e.cssModule,n=e.size,i=e.bordered,o=e.borderless,p=e.striped,h=e.dark,u=e.hover,f=e.responsive,g=e.tag,b=e.responsiveTag,x=e.innerRef,j=(0,r.A)(e,m),y=(0,d.qO)(c()(s,"table",!!n&&"table-"+n,!!i&&"table-bordered",!!o&&"table-borderless",!!p&&"table-striped",!!h&&"table-dark",!!u&&"table-hover"),t),w=l.createElement(g,(0,a.A)({},j,{ref:x,className:y}));if(f){var v=(0,d.qO)(!0===f?"table-responsive":"table-responsive-"+f,t);return l.createElement(b,{className:v},w)}return w};h.propTypes=p,h.defaultProps={tag:"table",responsiveTag:"div"};const u=h}}]);
//# sourceMappingURL=8888.28bffa3b.chunk.js.map