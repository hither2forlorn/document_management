{"version":3,"file":"static/js/2124.e8efabeb.chunk.js","mappings":"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","sources":["admin/views/DocumentManagement/components/Redaction.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport WebViewer from \"@pdftron/webviewer\";\r\n// import samplesSetup from \"@pdftron/webviewer\";\r\nimport { server, SERVER_URL } from \"admin/config/server\";\r\nimport A from \"config/url\";\r\nimport { getDocument, previewAttachment, provideTimelyAccess } from \"../api\";\r\nimport { Button, Card, CardHeader, CardBody, CardFooter, Input, Form, FormGroup, Label, Row, Col, Table } from \"reactstrap\";\r\nimport CustomCancel from \"admin/components/CustomCancel\";\r\nimport metaRoutes from \"config/meta_routes\";\r\nimport { toast } from \"react-toastify\";\r\nimport { getOneAttachments } from \"../api/attachment\";\r\n\r\nconst Redaction = (props) => {\r\n  let viewer = document.getElementById(\"file-viewer\");\r\n  const [documentData, setDocumentData] = useState([{}]);\r\n  const [attachments, setAttachments] = useState([{}]);\r\n  const [redactFile, setRedactFile] = useState(true);\r\n  const [attachmentData, setAttachmentData] = useState(\"\");\r\n  let attachmentId = props.location.state.selectedAttachmentId;\r\n\r\n  function samplesSetup(instance) {\r\n    instance.enableElements([\"bookmarksPanel\", \"bookmarksPanelButton\"]);\r\n    instance.enableFeatures([instance.Feature.Measurement]);\r\n  }\r\n\r\n  const loadDoc = () => {\r\n    let ids = A.getId(props.location.hash.slice(1));\r\n    if (ids) {\r\n      getDocument(\"\", ids, (err, json) => {\r\n        if (json.success) {\r\n          setDocumentData(json.data);\r\n          setAttachments(json.data.attachments ? json.data.attachments : []);\r\n        }\r\n      });\r\n    }\r\n  };\r\n  WebViewer(\r\n    {\r\n      path: \"./lib\",\r\n      initialDoc: \"\",\r\n      fullAPI: true,\r\n      // enableAnnotations: false,\r\n      enableRedaction: true,\r\n      documentType: \"pdf\",\r\n    },\r\n    viewer\r\n  )\r\n    .then((instance) => {\r\n      samplesSetup(instance);\r\n      let ids = A.getId(props.location.hash.slice(1));\r\n\r\n      document.getElementById(\"select\").onchange = (e) => {\r\n        let docPath = \"\";\r\n        let fileValue = e.target.options[e.target.selectedIndex].attributes[\"fileId\"].value;\r\n        previewAttachment(fileValue, (err, json) => {\r\n          if (err) return;\r\n          if (json.success) {\r\n            const filePath = SERVER_URL + \"/\" + json.filePath;\r\n            instance.loadDocument(filePath);\r\n          } else {\r\n            window.alert(json.message);\r\n          }\r\n        });\r\n      };\r\n      const { docViewer, annotManager, CoreControls, Annotations } = instance;\r\n      docViewer.on(\"documentLoaded\", () => {\r\n        const redact = new Annotations.RedactionAnnotation();\r\n        annotManager.addAnnotation(redact);\r\n        annotManager.drawAnnotationsFromList(redact);\r\n      });\r\n      // Add header button that will get file data on click\r\n      // instance.setToolMode(Tools.ToolNames.REDACTION);\r\n      instance.setHeaderItems((header) => {\r\n        header.push({\r\n          type: \"actionButton\",\r\n          img: \"icon-chevron-right\",\r\n          onClick: async () => {\r\n            const xfdfString = await annotManager.exportAnnotations();\r\n            const saveOptions = CoreControls.SaveOptions;\r\n            // annotManager.importAnnotations(xfdfString);\r\n            const options = {\r\n              xfdfString,\r\n              flags: saveOptions.LINEARIZED,\r\n              downloadType: \"pdf\",\r\n            };\r\n\r\n            const doc = docViewer.getDocument();\r\n            const fileName = doc.filename;\r\n            const data2 = await doc.getFileData(options);\r\n            const blob = new Blob([data2], { type: \"application/pdf\" });\r\n            const data1 = new FormData();\r\n            data1.append(\"fileType\", options.downloadType);\r\n            data1.append(\"itemId\", attachmentData.itemId);\r\n            data1.append(\"itemType\", \"document\");\r\n            data1.append(\"redaction\", redactFile);\r\n            data1.append(\"file\", blob, fileName);\r\n            for (var key of data1) {\r\n              console.log(key);\r\n            }\r\n            server\r\n              .post(\"/attachment\", data1)\r\n              .then((res) => {\r\n                props.history.push(metaRoutes.documentsView + \"?i=\" + props.location.hash.slice(1) + \"&type=redact\");\r\n                toast.success(\"successfully redacted\");\r\n              })\r\n              .catch((err) => console.log(err));\r\n\r\n            // instance.downloadPdf(options);\r\n          },\r\n        });\r\n      });\r\n    })\r\n    .catch((err) => console.log(err));\r\n\r\n  useEffect(() => {\r\n    getOneAttachments(attachmentId, (err, data) => {\r\n      if (err) {\r\n        console.log(err);\r\n      }\r\n      setAttachmentData(data);\r\n    });\r\n    loadDoc();\r\n  }, []);\r\n  return (\r\n    <>\r\n      <Card className=\"shadow\">\r\n        <CardHeader>\r\n          {\" \"}\r\n          <Row>\r\n            <Col>\r\n              <FormGroup>\r\n                <Label>Select Files</Label>\r\n\r\n                <Input id=\"select\" type=\"select\" className=\"w-50\">\r\n                  <option>--NONE--</option>\r\n                  {/* {attachments.map((row, index) => {\r\n                    if (!row.redaction) {\r\n                      return (\r\n                        <>\r\n                          {\r\n                            <option\r\n                              key={index}\r\n                              value={row.filePath}\r\n                              name={row.name}\r\n                              fileId={Number(row.id)}\r\n                            >\r\n                              {row.name}\r\n                            </option>\r\n                          }\r\n                        </>\r\n                      );\r\n                    }\r\n                  })} */}\r\n                  <option value={attachmentData.filePath} name={attachmentData.name} fileId={Number(attachmentData.id)}>\r\n                    {attachmentData.name}\r\n                  </option>\r\n                </Input>\r\n              </FormGroup>\r\n            </Col>\r\n          </Row>\r\n        </CardHeader>\r\n        <CardBody>\r\n          <div className=\"webviewer\" id=\"file-viewer\" style={{ height: \"100vh\" }}></div>\r\n        </CardBody>\r\n        <CardFooter className=\"d-flex justify-content-end\">\r\n          <CustomCancel onClick={() => window.history.back()} />\r\n        </CardFooter>\r\n      </Card>\r\n    </>\r\n  );\r\n};\r\nexport default Redaction;\r\n"],"names":["props","viewer","document","getElementById","documentData","setDocumentData","useState","attachments","setAttachments","redactFile","setRedactFile","attachmentData","setAttachmentData","attachmentId","location","state","selectedAttachmentId","WebViewer","path","initialDoc","fullAPI","enableRedaction","documentType","then","instance","enableElements","enableFeatures","Feature","Measurement","samplesSetup","A","getId","hash","slice","onchange","e","fileValue","target","options","selectedIndex","attributes","value","previewAttachment","err","json","success","filePath","SERVER_URL","loadDocument","window","alert","message","docViewer","annotManager","CoreControls","Annotations","on","redact","RedactionAnnotation","addAnnotation","drawAnnotationsFromList","setHeaderItems","header","push","type","img","onClick","async","xfdfString","exportAnnotations","flags","SaveOptions","LINEARIZED","downloadType","doc","getDocument","fileName","filename","data2","getFileData","blob","Blob","data1","FormData","key","append","itemId","console","log","server","post","res","history","metaRoutes","documentsView","toast","catch","useEffect","getOneAttachments","data","loadDoc","ids","_jsx","_Fragment","children","_jsxs","Card","className","CardHeader","Row","Col","FormGroup","Label","Input","id","name","fileId","Number","CardBody","style","height","CardFooter","CustomCancel","back"],"sourceRoot":""}